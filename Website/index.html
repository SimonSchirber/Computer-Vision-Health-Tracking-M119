<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./style.css">
    <title>Vision Health</title>
</head>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    //Where functions that can be called go
    function render_goals(){
        document.getElementById('Display').innerHTML +=
        '<div id = "Main_Page" class = "center">'+
            '<h1> Daily Workout Progress</h1>'+
            '<div class= "ProgressBar">'+
                '<div id="progress1">10%</div>'+
            '</div>'+
            '<h2 id = "p1"> 10/50 20lb Curl Reps</h2>'+

            '<div class= "ProgressBar">'+
                '<div id="progress2">10%</div>'+
            '</div>'+
            '<h2 id = "p2"> 10/50 30lb Curl Reps</h2>'+

            '<div class= "ProgressBar">'+
                '<div id="progress3">10%</div>'+
            '</div>'+
            '<h2 id = "p3"> 10/50 Lunges</h2>'+

            '<div class= "ProgressBar">'+
                '<div id="progress4">10%</div>'+
            '</div>'+
            '<h2 id = "p4"> 10/30 Minutes of Workout</h2>'+
       ' </div>'
        move_progressbar(1)
        move_progressbar(2)
        move_progressbar(3)
        move_progressbar(4)

    }
    function render_trends(){
        document.getElementById('Display').innerHTML += 
        '<div id = "Main_Page" class = "center">' +
            '<div id="20lbPlot" style="width:90%; padding: 15px;margin: auto;"></div>' +
            '<div  style="width:45%;"></div>' +
            '<div id="30lbPlot" style="width:90%; padding: 15px;margin: auto;"></div>' +
            '<div id="lungesPlot" style="width:90%; padding: 15px;margin: auto;"></div>'+
            '<div id="timePlot" style="width:90%; padding: 15px;margin: auto;"></div>'+   
        '</div>';
        var xArray = [1, 2, 3, 4, 5, 6, 7];
        //var yArray1 = [5, 20, 30, 42, 15, 69, 74];

        var yArray1 = JSON.parse(localStorage.getItem("curls20lbtrend"));
        var yArray2 = JSON.parse(localStorage.getItem("curls30lbtrend"));
        
        var yArray3 = JSON.parse(localStorage.getItem("lungestrend"));
        var yArray4 = JSON.parse(localStorage.getItem("timeworkouttrend"));

        // Define Data
        var data1 = [{x: xArray,y: yArray1, mode:"lines", type:"scatter"}];
        var data2 = [{x: xArray,y: yArray2, mode:"lines", type:"scatter"}];
        var data3 = [{x: xArray,y: yArray3, mode:"lines", type:"scatter"}];
        var data4 = [{x: xArray,y: yArray4, mode:"lines", type:"scatter"}];
        // Define Layout
        var layout1 = {xaxis: {range: [0, 7], title: "Last 7 Days"},yaxis: {range: [0, 120], title: "% Goal achieved"},  title: "20lb Curls"};
        var layout2 = {xaxis: {range: [0, 7], title: "Last 7 Days"},yaxis: {range: [0, 120], title: "% Goal achieved"},  title: "30lb Curls"};
        var layout3 = {xaxis: {range: [0, 7], title: "Last 7 Days"},yaxis: {range: [0, 120], title: "% Goal achieved"},  title: "Lunges"};
        var layout4 = {xaxis: {range: [0, 7], title: "Last 7 Days"},yaxis: {range: [0, 120], title: "% Goal achieved"},  title: "Time spent Woking out"};
        // Display using Plotly
        Plotly.newPlot("20lbPlot", data1, layout1);
        Plotly.newPlot("30lbPlot", data2, layout2);
        Plotly.newPlot("lungesPlot", data3, layout3);
        Plotly.newPlot("timePlot", data4, layout4);

        

    }
    function render_edits(){
        document.getElementById('Display').innerHTML += 
        '<div id = "Main_Page" class = "center">' +
            '<form action="/action_page.php" style=" padding: 15px;margin: auto;>'+
                '<label for="quantity">Daily 20lb Curls:</label>'+
                '<input type="number" id="quant20lbs" name="quantity" min="1" max="100">'+
                '<input type="submit" value="Update Goal">'+
            '</form>'+
     
            '<form action="/action_page.php" style=" padding: 15px;margin: auto;>'+
                '<label for="quantity">Daily 30lb Curls:</label>'+
                '<input type="number" id="quant30lbs" name="quantity" min="1" max="100">'+
                '<input type="submit" value="Update Goal">'+
            '</form>'+

            '<form action="/action_page.php" style=" padding: 15px;margin: auto;>'+
                '<label for="quantity">Daily Lunges:</label>'+
                '<input type="number" id="quantLunges" name="quantity" min="1" max="100">'+
                '<input type="submit" value="Update Goal">'+
            '</form>'+
        
            '<form action="/action_page.php" style=" padding: 15px;margin: auto;>'+
                '<label for="quantity">Daily Workout Time:</label>'+
                '<input type="number" id="quantworkouttime" name="quantity" min="1" max="100">'+
                '<input type="submit" value="Update Goal">'+
            '</form>'+
        '</div>';

    }
    function change_screen(screen_num, remove = true){
        //Clear whiite border on all buttons
        document.getElementById("daily_progress").style.border = "0px solid rgb(248, 246, 246)";
        document.getElementById("weekly_trends").style.border = "0px solid rgb(248, 246, 246)";
        document.getElementById("edit_goals").style.border = "0px solid rgb(248, 246, 246)";
        if (remove){
            document.getElementById("Main_Page").remove();
        }
        if (screen_num == 1){
            document.getElementById("daily_progress").style.border = "8px solid rgb(248, 246, 246)";
            render_goals()
        }
        if (screen_num == 2){
            document.getElementById("weekly_trends").style.border = "8px solid rgb(248, 246, 246)";
            render_trends()
        }
        if (screen_num == 3){
            document.getElementById("edit_goals").style.border = "8px solid rgb(248, 246, 246)";
            render_edits()
        }
        
    }
    function update_progress_bar(barID, percentage){
        var element = document.getElementById(barID);
        var width = percentage;
    }
    function update_goal_text(complete, goal, progbar_num){
        if (progbar_num == 1){
            document.getElementById("p1").innerHTML = `${complete}/${goal}  20lb Curl Reps`
        }
        else if(progbar_num == 2){
            document.getElementById("p2").innerHTML = `${complete}/${goal}  30lb Curl Reps`
        }
        else if(progbar_num == 3){
            document.getElementById("p3").innerHTML = `${complete}/${goal}  Lunges`
        }
        else if(progbar_num == 4){
            document.getElementById("p4").innerHTML = `${complete}/${goal}  Minutes of Workout`
        }
    }
    function move_progressbar(bar_num) {
        var progressbar = document.getElementById(`progress${bar_num}`);   
        width = 0
        var goal_name
        if (bar_num == 1){
            goal_name = 'curls20lb'
            console.log("True")
        }
        else if (bar_num == 2){
            goal_name = 'curls30lb'
        }
        else if (bar_num == 3){
            goal_name = 'lunges'
        }
        else if (bar_num == 4){
            goal_name = 'timeworkout'
        }
        var goal_data = JSON.parse(localStorage.getItem(goal_name))
        var goal = goal_data['goal']
        var complete = goal_data['complete']
        var goal_percent_hit = Math.round(100*complete/goal)
        if (goal_percent_hit>=100){
            goal_percent_hit = 100
        }
        var id = setInterval(frame, 10);
        function frame() {
            if (width >= goal_percent_hit) {
            clearInterval(id);
            } else {
            width++; 
            progressbar.style.width = width + '%'; 
            progressbar.innerHTML = '&nbsp' + width * 1  + '%';
            }
        }
        if (goal_percent_hit == 0) {
            progressbar.style.width = width + '%'
            progressbar.innerHTML = '&nbsp' + width * 1  + '%'
        }
        update_goal_text(complete, goal, bar_num)
    }
</script>
<!--Top Buttons-->
<body style="background-color:rgb(196, 167, 212);" >
    <div>
        <button  id = "daily_progress" class="daily_progress" type="button" onclick="change_screen(1, true)">Daily Progress</button>
        <button id = "weekly_trends"  class="weekly_trends" type="button" onclick="change_screen(2, true)">Trends</button>
        <button id = "edit_goals" class="edit_goals" type="button" onclick="change_screen(3, true)">Edit Goals</button>
    </div>
    <!--Main Page Display-->
    <div id = "Display">
        <div id = "Main_Page" class = "center">
            <h1> Daily Workout Progress</h1>

            <div class= "ProgressBar">
                <div id="progress1">10%</div>
            </div>
            <h2 id = "p1"> 10/50 20lb Curl Reps</h2>

            <div class= "ProgressBar">
                <div id="progress2">10%</div>
            </div>
            <h2 id = "p2"> 10/50 30lb Curl Reps</h2>

            <div class= "ProgressBar">
                <div id="progress3">10%</div>
            </div>
            <h2 id = "p3"> 10/50 Lunges</h2>

            <div class= "ProgressBar">
                <div id="progress4">10%</div>
            </div>
            <h2 id = "p4"> 10/30 Minutes of Workout</h2>
        </div>
    </div>  
    <!--Initialization Script--> 
    <script src="./js/health_init.js" type = "module"></script>
    
</body>
</html>